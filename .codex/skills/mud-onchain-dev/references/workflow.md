# MUD実装ワークフロー

## 1. Discovery
- 対象機能のユースケースを時系列で列挙する。
- 操作主体（Player/Admin/System）と入力ソース（tx/UI/cron）を明確化する。
- 既存テーブルとSystemへの影響範囲を確認する。

## 2. Schema Draft
- テーブル定義に対して以下を記録する。
- 主キー設計（Entity/Composite key）
- 更新頻度（高/中/低）
- 整合性ルール（一意制約、状態遷移条件）
- オンチェーンに残す理由

## 3. System Design
- 入口関数ごとに以下を決める。
- 前提条件（権限、状態、入力範囲）
- 状態遷移（before/after）
- 発火イベント
- 失敗時の扱い

## 4. Implementation
- 先に失敗パス（invalid input, unauthorized, stale state）を実装する。
- 成功パスは最小変更で通し、必要な副作用のみ追加する。
- 外部依存（oracle/bridge/RPC）を直接前提にしない。

## 5. Verification
- Systemテスト: 正常系 + 失敗系 + 境界値。
- 統合テスト: 代表ユーザーフローを1本以上。
- 同期確認: クライアントの表示とチェーン状態が一致するか。
- ガス比較: 主要関数で変更前後差分を確認。

## 6. Release
- デプロイ対象チェーンを固定する。
- デプロイ手順をコマンド単位で記録する。
- リリース後に監視するメトリクス（失敗Tx率、同期遅延、主要操作完了率）を設定する。

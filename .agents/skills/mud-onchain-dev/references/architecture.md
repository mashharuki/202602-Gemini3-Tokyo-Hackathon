# MUDアーキテクチャ設計ガイド

## テーブル設計
- 読み取り最適化と書き込み最適化を分離して考える。
- 集計値は都度計算よりキャッシュ列を優先し、更新責務をSystem側で明示する。
- 将来の仕様追加を想定し、可変長データの格納方針を先に決める。

## Entityモデリング
- プレイヤー、ユニット、マップ、アイテムなどのライフサイクル境界を分離する。
- 永続Entityと一時Entityを混在させない。
- 参照関係は循環しないようにし、削除/無効化戦略を定義する。

## System分割
- Command系（状態変更）とQuery補助系（読み取り補助）を分ける。
- System名はユースケース単位で命名し、汎用Util化しすぎない。
- ガード条件の共通化は内部ライブラリ化して重複を避ける。

## イベントと同期
- クライアントで必要な更新単位に合わせてイベントを設計する。
- UIが必要とする最小データをイベントに含め、過剰フェッチを避ける。
- eventual consistency前提で、再取得戦略と表示規則（pending/reconciled/error）を定める。

## セキュリティ/信頼性
- 権限判定は呼び出しの入口で実行する。
- 外部コール前後の状態変更順序を固定し、再入可能性を検証する。
- 失敗時の復旧手順（再送、状態再同期）をRunbook化する。

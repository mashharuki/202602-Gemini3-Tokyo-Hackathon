# Implementation Tasks: feature-threejs-world

- [x] 1. 開発環境の最終調整と依存関係の検証 (P)
  - `packages/client/package.json` に必要な依存関係（`@react-three/drei`, `@react-three/postprocessing`, `postprocessing`）が正しく追加されているか確認し、インストールを実行する
  - `vite.config.ts` でカスタムシェーダー（GLSL）を扱うための設定が必要か検証し、適切に構成する
  - _Requirements: 4.2_

- [x] 2. Core World Rendering: マトリックス風空間の構築 (P)
- [x] 2.1 (P) 高品質な 3D グリッド地形と環境光の実装
  - ダークトーンを基調とした背景と、ネオンカラーの `Grid` ヘルパーを組み合わせた基礎空間を構築する
  - `Environment` と `OrbitControls` を設定し、デモ開始時点で「見渡せる」体験を確立する
  - _Requirements: 1.1, 1.2, 1.4_
- [x] 2.2 (P) 基本ポストプロセッシング（Scanline, Bloom）の適用
  - `EffectComposer` を導入し、走査線とグロー効果を組み合わせてマトリックス特有の質感を再現する
  - 表示が飽和しすぎないよう、しきい値と強度を調整して情報の判読性を確保する
  - _Requirements: 1.1, 1.3, 3.2_

- [x] 3. MUD Integration: オンチェーン状態との物理的同期
- [x] 3.1 (P) WorldEffect テーブル購読フックの実装
  - MUD の `useEntityQuery` を使用し、オンチェーンの `WorldEffect` コンポーネントの状態を安定して取得するフックを作成する
  - 状態停止時や不正データ受信時に、直前の整合状態を維持または安全に代替値を返すガードロジックを実装する
  - _Requirements: 2.3, 4.1, 4.2, 4.3_
- [x] 3.2 (P) 世界エフェクトレンダラーの基礎構築
  - 受信したエフェクトデータ（座標、色、強度）に基づいて、3D 空間上に光輝くオブジェクトやプリミティブを描画するベースコンポーネントを実装する
  - 連続的な更新が発生しても表示が最新状態に安全に追従することを確認する
  - _Requirements: 2.1, 2.4, 4.4_

- [x] 4. Advanced VFX: 重畳制御と特殊エフェクト
- [x] 4.1 エフェクトコンポジターによるパラメータ動的調整の実装
  - 複数のエフェクトが重なった際、`activeEffects` の数に応じて強度の自動スケールや優先度付けを行い、可読性を維持する
  - 各エフェクトカテゴリ（Ripple, Resonance 等）に応じた合成ロジック（BlendFunction）を選択する
  - _Requirements: 3.1, 3.2, 3.3, 3.4_
- [x] 4.2 特殊シェーダーエフェクト（Ripple, Resonance）の実装
  - MUD から渡される座標を中心に、画面歪みを生じさせる波紋（Ripple）と、頂点変位による共鳴（Resonance）演出をカスタムパスとして追加する
  - _Requirements: 2.2, 5.4_

- [x] 5. Quality & Performance: デモ安定性の確保
- [x] 5.1 動的 LOD (Level of Detail) と負荷制御の実装
  - フレームレートを監視し、低スペック機材や高負荷時にポスト処理パスを動的に省略するティア別品質制御を実装する
  - 致命的な描画エラーを検知した場合に、最小限の表示でセッションを継続する安全機構を導入する
  - _Requirements: 5.1, 5.2, 5.3_
- [x] 5.2* 統合検証とパフォーマンステスト
  - 実機デモを想定し、オンチェーン更新と同期した際の視覚品質と安定性を最終確認する
  - 初期化から反映完了までのライフサイクルが運用観測可能な状態であることを検証する
  - _Requirements: 5.4, 6.1, 6.2, 6.4_

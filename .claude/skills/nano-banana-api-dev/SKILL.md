---
name: nano-banana-api-dev
description: Nano banana API（Gemini APIの画像生成/編集機能）を使ったアプリ開発を包括支援するスキル。要件定義、API設計、Node.js実装、マルチターン画像編集、入出力バリデーション、運用トラブルシュートまで一貫して進めるときに使用する。Gemini APIで画像生成アプリ、画像編集ワークフロー、プロンプト駆動クリエイティブ機能を新規開発・改修する場面でトリガーする。
---

# Nano Banana API Dev

## 概要
Nano banana API を使う機能開発を、設計から実装・検証・運用まで通しで進める。単発生成だけでなく、画像入力編集・チャット継続編集・安全な本番運用を同じ基準で扱う。

## クイックスタート
1. 画像生成モデルと入出力仕様を先に固定する。
2. API呼び出しをアプリ本体から分離し、薄いサービス層を作る。
3. まずテキスト入力生成を通し、次に画像入力編集へ拡張する。
4. エラー分類（認証/入力/サイズ/レート）と再試行戦略を実装する。
5. 実運用前にレイテンシ、失敗率、生成品質の計測を追加する。

## 実行手順

### 1. 要件整理
- 生成タスクを分類する: 新規生成、既存画像編集、会話継続編集。
- 品質要件を定義する: 解像感、一貫性、許容遅延、失敗時UX。
- 取り扱う画像の上限サイズと形式を先に決める。

### 2. API契約設計
- フロント入力は必ずサーバー側で再検証する。
- プロンプト、任意の入力画像、出力形式、失敗コードを明文化する。
- レスポンスは `text` と `image bytes` を分離して扱う。

### 3. 実装
- 生成/編集/継続編集を別関数に分割する。
- APIキーは環境変数管理し、クライアントへ露出させない。
- 画像パート抽出処理を共通化して重複を避ける。

### 4. 検証
- 正常系: テキストのみ生成、画像入力編集、複数ターン編集。
- 異常系: 不正MIME、サイズ超過、空プロンプト、API失敗。
- 回帰: 主要ユースケースで出力品質が劣化していないか確認する。

### 5. 運用
- 失敗率、平均応答時間、生成キャンセル率を監視する。
- レート制限とバックオフを導入する。
- 不適切出力へのハンドリング方針を定義する。

## 同梱スクリプト
- `scripts/generate_image.mjs`: テキストから画像生成。
- `scripts/edit_image_with_text.mjs`: 入力画像 + プロンプトで編集。
- `scripts/multi_turn_image_chat.mjs`: チャット継続で段階編集。

## 参照資料
- 開発全体フロー: `references/workflow.md`
- API実装パターン: `references/api-playbook.md`
- 障害対応/運用: `references/troubleshooting.md`

# Troubleshooting

## 401/403 認証エラー
- `GEMINI_API_KEY` の設定と環境注入先を確認する。
- サーバープロセスが最新の環境変数を読んでいるか確認する。

## 400 入力エラー
- 空プロンプトや不正MIMEを確認する。
- base64文字列に改行や欠損がないか確認する。

## 画像が返らない
- `responseModalities` に `IMAGE` が含まれているか確認する。
- `parts` の走査で `inlineData` を正しく拾えているか確認する。

## レイテンシ増大
- 同期処理での画像保存I/Oを見直す。
- 再試行設定が過剰でないか確認する。

## 失敗率が高い
- 入力バリデーション不足を疑う。
- サイズ上限を超える入力を事前リサイズする。
- リクエスト頻度に応じたレート制御を追加する。
